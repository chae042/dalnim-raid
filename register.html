<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸŒ™ ë ˆì´ë“œ ë“±ë¡</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: #1a1a2e;
    color: #e0e0e0;
    padding: 16px;
    min-height: 100vh;
  }

  .container {
    max-width: 100%;
    margin: 0 auto;
  }

  .header {
    text-align: center;
    margin-bottom: 24px;
    padding-top: 8px;
  }

  .header h1 {
    font-size: 24px;
    font-weight: 700;
    color: #ffd700;
    margin-bottom: 4px;
  }

  .header .subtitle {
    font-size: 14px;
    color: #888;
  }

  .form-card {
    background: #16213e;
    padding: 20px;
    border-radius: 16px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 10px;
    font-size: 15px;
    color: #aaa;
    font-weight: 500;
  }

  .form-group label .required {
    color: #ff6b6b;
  }

  .form-group input[type="text"],
  .form-group select {
    width: 100%;
    padding: 16px;
    font-size: 18px;
    border: 2px solid #2a2a4a;
    border-radius: 12px;
    background: #1a1a2e;
    color: #fff;
    font-family: inherit;
    -webkit-appearance: none;
  }

  .form-group input:focus,
  .form-group select:focus {
    outline: none;
    border-color: #ffd700;
  }

  .search-box {
    display: flex;
    gap: 10px;
  }

  .search-box input {
    flex: 1;
    min-width: 0;
  }

  .search-btn {
    padding: 16px 20px;
    background: #ffd700;
    border: none;
    border-radius: 12px;
    color: #1a1a2e;
    cursor: pointer;
    font-size: 16px;
    font-weight: 700;
    white-space: nowrap;
  }

  .search-btn:hover {
    background: #ffed4a;
  }

  .search-btn:disabled {
    background: #444;
    color: #888;
  }

  .day-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }

  .day-btn {
    padding: 14px 0;
    font-size: 16px;
    border: 2px solid #2a2a4a;
    border-radius: 10px;
    background: transparent;
    color: #888;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 600;
  }

  .day-btn:hover {
    border-color: #ffd700;
    color: #ffd700;
  }

  .day-btn.selected {
    background: #ff6b6b;
    border-color: #ff6b6b;
    color: #fff;
  }

  .submit-btn {
    width: 100%;
    padding: 18px;
    font-size: 20px;
    font-weight: 700;
    border: none;
    border-radius: 12px;
    background: #ffd700;
    color: #1a1a2e;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
  }

  .submit-btn:hover {
    background: #ffed4a;
  }

  .submit-btn:disabled {
    background: #444;
    color: #888;
    cursor: not-allowed;
  }

  .message {
    padding: 14px 16px;
    border-radius: 10px;
    margin-bottom: 16px;
    text-align: center;
    font-size: 15px;
    font-weight: 500;
  }

  .message.success { 
    background: rgba(46, 204, 113, 0.2); 
    color: #2ecc71; 
    border: 1px solid #2ecc71; 
  }
  .message.error { 
    background: rgba(231, 76, 60, 0.2); 
    color: #e74c3c; 
    border: 1px solid #e74c3c; 
  }
  .message.info { 
    background: rgba(52, 152, 219, 0.2); 
    color: #3498db; 
    border: 1px solid #3498db; 
  }

  .divider {
    height: 1px;
    background: #2a2a4a;
    margin: 24px 0;
  }

  .link-section {
    text-align: center;
    margin-top: 20px;
  }

  .link-section a {
    color: #60a5fa;
    text-decoration: none;
    font-size: 14px;
  }

  .link-section a:hover {
    text-decoration: underline;
  }

  /* í° í„°ì¹˜ ì˜ì—­ */
  select {
    min-height: 54px;
  }

  .footer {
    text-align: center;
    margin-top: 24px;
    font-size: 12px;
    color: #444;
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸŒ™ ë ˆì´ë“œ ë“±ë¡</h1>
    <div class="subtitle">ì¼ì • ë“±ë¡ ë° ìˆ˜ì •</div>
  </div>

  <div class="form-card">
    <div id="register-message"></div>
    
    <div class="form-group">
      <label>ë‹‰ë„¤ì„ <span class="required">*</span></label>
      <div class="search-box">
        <input type="text" id="nickname" placeholder="ìºë¦­í„° ì´ë¦„" autocomplete="off">
        <button class="search-btn" onclick="loadMyInfo()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
      </div>
    </div>

    <div class="form-group">
      <label>ì§ì—… <span class="required">*</span></label>
      <select id="job">
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="ìˆ˜í˜¸ì„±">ğŸ›¡ ìˆ˜í˜¸ì„±</option>
        <option value="ê²€ì„±">âš”ï¸ ê²€ì„±</option>
        <option value="ê¶ì„±">ğŸ¹ ê¶ì„±</option>
        <option value="ë§ˆë„ì„±">â—† ë§ˆë„ì„±</option>
        <option value="ì¹˜ìœ ì„±">âœš ì¹˜ìœ ì„±</option>
        <option value="í˜¸ë²•ì„±">â—ˆ í˜¸ë²•ì„±</option>
        <option value="ì‚´ì„±">ğŸ—¡ ì‚´ì„±</option>
        <option value="ì •ë ¹ì„±">ğŸ”® ì •ë ¹ì„±</option>
      </select>
    </div>

    <div class="form-group">
      <label>ë„¤ì„ë“œ</label>
      <select id="named">
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="1ë„´">1ë„´</option>
        <option value="2ë„´">2ë„´</option>
      </select>
    </div>

    <div class="divider"></div>

    <div class="form-group">
      <label>ì‹œì‘ ê°€ëŠ¥ ì‹œê°„</label>
      <select id="startTime">
        <option value="ìƒê´€ì—†ìŒ">ìƒê´€ì—†ìŒ</option>
        <option value="PM 6">PM 6 (18ì‹œ)</option>
        <option value="PM 7">PM 7 (19ì‹œ)</option>
        <option value="PM 8">PM 8 (20ì‹œ)</option>
        <option value="PM 9">PM 9 (21ì‹œ)</option>
        <option value="PM 10">PM 10 (22ì‹œ)</option>
        <option value="PM 11">PM 11 (23ì‹œ)</option>
        <option value="AM 12">AM 12 (24ì‹œ)</option>
        <option value="AM 1">AM 1 (01ì‹œ)</option>
        <option value="AM 2">AM 2 (02ì‹œ)</option>
      </select>
    </div>

    <div class="form-group">
      <label>ì¢…ë£Œ ê°€ëŠ¥ ì‹œê°„</label>
      <select id="endTime">
        <option value="ìƒê´€ì—†ìŒ">ìƒê´€ì—†ìŒ</option>
        <option value="PM 6">PM 6 (18ì‹œ)</option>
        <option value="PM 7">PM 7 (19ì‹œ)</option>
        <option value="PM 8">PM 8 (20ì‹œ)</option>
        <option value="PM 9">PM 9 (21ì‹œ)</option>
        <option value="PM 10">PM 10 (22ì‹œ)</option>
        <option value="PM 11">PM 11 (23ì‹œ)</option>
        <option value="AM 12">AM 12 (24ì‹œ)</option>
        <option value="AM 1">AM 1 (01ì‹œ)</option>
        <option value="AM 2">AM 2 (02ì‹œ)</option>
      </select>
    </div>

    <div class="divider"></div>

    <div class="form-group">
      <label>ë ˆì´ë“œ ì¢…ë¥˜</label>
      <select id="raidType">
        <option value="íŠ¸ë¼ì´íŒŸ">íŠ¸ë¼ì´íŒŸ</option>
        <option value="í´ë¦¬ì–´íŒŸ">í´ë¦¬ì–´íŒŸ</option>
      </select>
    </div>

    <div class="form-group">
      <label>ëª»í•˜ëŠ” ìš”ì¼ (í„°ì¹˜í•´ì„œ ì„ íƒ)</label>
      <div class="day-buttons">
        <button type="button" class="day-btn" data-day="ì›”">ì›”</button>
        <button type="button" class="day-btn" data-day="í™”">í™”</button>
        <button type="button" class="day-btn" data-day="ìˆ˜">ìˆ˜</button>
        <button type="button" class="day-btn" data-day="ëª©">ëª©</button>
        <button type="button" class="day-btn" data-day="ê¸ˆ">ê¸ˆ</button>
        <button type="button" class="day-btn" data-day="í† ">í† </button>
        <button type="button" class="day-btn" data-day="ì¼">ì¼</button>
      </div>
    </div>

    <div class="divider"></div>

    <div class="form-group">
      <label>ì°¸ê³ ì‚¬í•­</label>
      <input type="text" id="note" placeholder="ì˜ˆ: ê¸ˆí† ë§Œ ê°€ëŠ¥, 24ì‹œ ì´ì „ ì„ í˜¸">
    </div>

    <button class="submit-btn" onclick="submitForm()">ì €ì¥í•˜ê¸°</button>
  </div>

  <div class="link-section">
    <a href="index.html">ğŸ“‹ ì¼ì • ë³´ê¸° (PC ê¶Œì¥)</a>
  </div>

  <div class="footer">
    ğŸŒ™ ë‹¬ë‹˜ë´‡
  </div>
</div>

<script>
const WEBHOOK_URL = 'https://n8n-production-f0a7.up.railway.app/webhook/raid';

// ìš”ì¼ ë²„íŠ¼ í† ê¸€
document.querySelectorAll('.day-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    btn.classList.toggle('selected');
  });
});

function getSelectedDays() {
  const days = [];
  document.querySelectorAll('.day-btn.selected').forEach(btn => {
    days.push(btn.dataset.day);
  });
  return days;
}

function showMessage(type, text) {
  const el = document.getElementById('register-message');
  el.innerHTML = `<div class="message ${type}">${text}</div>`;
  
  // ì„±ê³µ/ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ìŠ¤í¬ë¡¤ ìƒë‹¨ìœ¼ë¡œ
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  setTimeout(() => { el.innerHTML = ''; }, 5000);
}

// ë‚´ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadMyInfo() {
  const nickname = document.getElementById('nickname').value.trim();
  if (!nickname) {
    showMessage('error', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”');
    return;
  }

  const btn = document.querySelector('.search-btn');
  btn.disabled = true;
  btn.textContent = 'ê²€ìƒ‰ì¤‘...';

  try {
    const response = await fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'get', data: { 'ë‹‰ë„¤ì„': nickname } })
    });
    const result = await response.json();
    
    console.log('ë¶ˆëŸ¬ì˜¤ê¸° ê²°ê³¼:', result);
    
    if (result.success && result.data) {
      const d = result.data;
      
      document.getElementById('job').value = d.ì§ì—… || '';
      document.getElementById('named').value = d.ë„¤ì„ë“œ || '';
      document.getElementById('startTime').value = d.ì‹œì‘ì‹œê°„ || 'ìƒê´€ì—†ìŒ';
      document.getElementById('endTime').value = d.ì¢…ë£Œì‹œê°„ || 'ìƒê´€ì—†ìŒ';
      document.getElementById('raidType').value = d.ë ˆì´ë“œì¢…ë¥˜ || 'íŠ¸ë¼ì´íŒŸ';
      document.getElementById('note').value = d.ì°¸ê³ ì‚¬í•­ || '';
      
      // ëª»í•˜ëŠ” ìš”ì¼ ë¦¬ì…‹ í›„ ì„¤ì •
      document.querySelectorAll('.day-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      if (d.ëª»í•˜ëŠ”ìš”ì¼ && Array.isArray(d.ëª»í•˜ëŠ”ìš”ì¼)) {
        d.ëª»í•˜ëŠ”ìš”ì¼.forEach(day => {
          const btn = document.querySelector(`.day-btn[data-day="${day}"]`);
          if (btn) btn.classList.add('selected');
        });
      }
      
      showMessage('success', `${nickname}ë‹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤`);
    } else {
      showMessage('info', 'ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ë“±ë¡í•´ì£¼ì„¸ìš”.');
    }
  } catch (error) {
    console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì—ëŸ¬:', error);
    showMessage('error', 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'ë¶ˆëŸ¬ì˜¤ê¸°';
  }
}

// í¼ ì œì¶œ
async function submitForm() {
  const nickname = document.getElementById('nickname').value.trim();
  const job = document.getElementById('job').value;
  
  if (!nickname) {
    showMessage('error', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”');
    return;
  }
  if (!job) {
    showMessage('error', 'ì§ì—…ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }

  const data = {
    'ë‹‰ë„¤ì„': nickname,
    'ì§ì—…': job,
    'ë„¤ì„ë“œ': document.getElementById('named').value || '',
    'ì‹œì‘ì‹œê°„': document.getElementById('startTime').value,
    'ì¢…ë£Œì‹œê°„': document.getElementById('endTime').value,
    'ëª»í•˜ëŠ”ìš”ì¼': getSelectedDays(),
    'ë ˆì´ë“œì¢…ë¥˜': document.getElementById('raidType').value,
    'ì°¸ê³ ì‚¬í•­': document.getElementById('note').value || ''
  };

  const btn = document.querySelector('.submit-btn');
  btn.disabled = true;
  btn.textContent = 'ì €ì¥ ì¤‘...';

  try {
    const response = await fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'register', data })
    });
    const result = await response.json();
    
    if (result.success) {
      showMessage('success', 'âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } else {
      showMessage('error', 'ì €ì¥ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
    }
  } catch (error) {
    showMessage('error', 'ì €ì¥ ì‹¤íŒ¨: ' + error.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'ì €ì¥í•˜ê¸°';
  }
}
</script>

</body>
</html>
